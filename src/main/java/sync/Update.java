package sync;import java.io.BufferedReader;import java.io.BufferedWriter;import java.io.FileReader;import java.io.FileWriter;import java.io.IOException;import java.io.InputStream;import java.text.DateFormat;import java.util.Arrays;import java.util.Date;import java.util.List;import java.util.Properties;import org.jsoup.Jsoup;import org.jsoup.nodes.Document;import org.jsoup.nodes.Element;import org.jsoup.nodes.Node;public class Update {    private static final String filePath = System.getProperty("user.dir") + "/README.md";    private static final String hostsPath = System.getProperty("user.dir") + "/hosts";    private static final String templatePath = System.getProperty("user.dir") + "/template.md";    private static final List<String> githubUrls = Arrays.asList(            "github.githubassets.com",            "central.github.com",            "desktop.githubusercontent.com",            "assets-cdn.github.com",            "camo.githubusercontent.com",            "github.map.fastly.net",            "github.global.ssl.fastly.net",            "gist.github.com",            "github.io",            "github.com",            "api.github.com",            "raw.githubusercontent.com",            "user-images.githubusercontent.com",            "favicons.githubusercontent.com",            "avatars5.githubusercontent.com",            "avatars4.githubusercontent.com",            "avatars3.githubusercontent.com",            "avatars2.githubusercontent.com",            "avatars1.githubusercontent.com",            "avatars0.githubusercontent.com",            "avatars.githubusercontent.com",            "codeload.github.com",            "github-cloud.s3.amazonaws.com",            "github-com.s3.amazonaws.com",            "github-production-release-asset-2e65be.s3.amazonaws.com",            "github-production-user-asset-6210df.s3.amazonaws.com",            "github-production-repository-file-5c1aeb.s3.amazonaws.com",            "githubstatus.com",            "github.community",            "media.githubusercontent.com",            "copilot-proxy.githubusercontent.com",            "cloud.githubusercontent.com",            "pipelines.actions.githubusercontent.com",            "objects.githubusercontent.com"    );    private static final String ipAddressBaseUrl = "https://www.ipaddress.com/site/";    public static String resolveUrl(String url) {        return ipAddressBaseUrl + url;    }    public static String lJust(String str, int total, String pad) {        String res = String.format("%-" + total + "s", str);        res = res.replaceAll("\\s", pad);        return res;    }    public static String findWrapper(String host) {        int retryCount = 3;        String result = "";        for (;;) {            if (retryCount <= 0) {                System.out.println(host + " is failed.");                break;            }            try {                result = findIp(host);                if (result != null && !result.equals("")) {                    break;                }            } catch (Exception e) {                System.out.println("findIp has a error:" + e);            }            retryCount--;        }        return result;    }    public static String findIp(String host) throws Exception {        String url = resolveUrl(host);        System.out.println("request url = " + url);        Document doc = Jsoup.connect(url)                .userAgent("Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.77 Safari/537.36 Edg/91.0.864.37")                .timeout(20000)                .get();        String ip = "";        List<Node> trNodes = doc.select("#dns > tbody").get(0).childNodes();        for (Node node : trNodes) {            if (node.childNodes().size() >= 2) {                Element aElement = (Element) node.childNode(0);                if (aElement.text().equals("A")) {                    Element element = (Element) node.childNode(1);                    ip = element.text();                }            }            if (!ip.equals("")) {                break;            }        }        System.out.println("parse host = " + ip);        return ip;    }    public static void main(String[] args) {        StringBuilder generateContent = new StringBuilder();        for (String host : githubUrls) {            String result = findWrapper(host);            if (result != null && !result.equals("")) {                generateContent.append(lJust(result, 30, " ")).append(host).append("\n");            }        }        System.out.println(generateContent);        String fileContent = readFileContent(templatePath, generateContent.toString());        writeFile(filePath, fileContent);        writeFile(hostsPath, getHostsContent(generateContent.toString()));    }    public static String getProperty(String key) {        // è¯»å–æœ¬åœ°propertieså±æ€§æ–‡ä»¶(é‡è¦)        Properties properties = new Properties();        try {            //æŠŠæœ¬åœ°çš„propertieså±æ€§æ–‡ä»¶è½¬æ¢æˆJavaå¯¹è±¡(æµå¯¹è±¡)è¿”å›,å‚æ•°ä¸ºé…ç½®æ–‡ä»¶çš„åœ°å€,åœ°å€åªéœ€è¦ä»baoè·¯å¾„å¼€å§‹            InputStream is = Thread.currentThread().getContextClassLoader().                    getResourceAsStream("config.properties");            //åŠ è½½é…ç½®ä¿¡æ¯            //load  æŠ›å‡ºå¼‚å¸¸ï¼Œtry  catch  æ•è·å¼‚å¸¸            properties.load(is);        } catch (IOException e) {            e.printStackTrace();        }        return properties.getProperty(key);    }    public static String getHostsContent(String content) {        return "# è¿‘æœŸæœ‰å°ä¼™ä¼´åé¦ˆè·å–hostsæœ‰å¯èƒ½ä¸ºç©ºï¼Œè¯·å¤§å®¶å…³æ³¨GitHubåŠæ—¶æIssueï¼Œæˆ‘ä¼šç¬¬ä¸€æ—¶é—´ä¿®å¤ï¼Œè°¢è°¢ğŸ™"            + System.getProperty("line.separator")            + "# ä¹Ÿå¯ä»¥å…³æ³¨å…¬ä¼—å·ï¼šä¸ƒå“¥èŠç¼–ç¨‹ï¼Œæ°¸ä¹…ä¸è¿·è·¯."            + System.getProperty("line.separator")            + "# GitHub Host Start\n\n"            + content            + System.getProperty("line.separator")            + "# Please Star: https://github.com/isevenluo/github-hosts"            + System.getProperty("line.separator")            + "# Update at: " + DateFormat.getDateTimeInstance().format(new Date())            + System.getProperty("line.separator") + "\n"            + "# GitHub Host End";    }    public static String readFileContent(String filePath, String content) {        BufferedReader br = null;        String line;        //ä¿å­˜ä¿®æ”¹è¿‡åçš„æ‰€æœ‰å†…å®¹ï¼Œä¸æ–­å¢åŠ         StringBuilder bufAll = new StringBuilder();        try {            br = new BufferedReader(new FileReader(filePath));            while ((line = br.readLine()) != null) {                StringBuilder buf = new StringBuilder();                //ä¿®æ”¹å†…å®¹æ ¸å¿ƒä»£ç                 if (line.startsWith("# GitHub Host Start")) {                    buf.append(line).append("\n\n");                    do {                        line = br.readLine();                    } while (!line.startsWith("# Please Star"));                    buf.append(content);                    buf.append(System.getProperty("line.separator"));                    buf.append(line);                } else if (line.startsWith("# Update at")) {                    buf.append(line);                    buf.replace(13, line.length(), DateFormat.getDateTimeInstance().format(new Date()));                } else if (line.startsWith("å†…å®¹å®šæ—¶æ›´æ–°ï¼Œæœ€è¿‘æ›´æ–°æ—¶é—´ï¼š")) {                    buf.append(line);                    buf.replace(14, line.length(), DateFormat.getDateTimeInstance().format(new Date()));                } else {                    buf.append(line);                }                buf.append(System.getProperty("line.separator"));                bufAll.append(buf);            }        } catch (Exception e) {            e.printStackTrace();        } finally {            if (br != null) {                try {                    br.close();                } catch (IOException e) {                    e.printStackTrace();                }            }        }        return bufAll.toString();    }    //å†™å›æ–‡ä»¶    public static void writeFile(String filePath, String content) {        BufferedWriter bw = null;        try {            bw = new BufferedWriter(new FileWriter(filePath));            bw.write(content);        } catch (Exception e) {            e.printStackTrace();        } finally {            if (bw != null) {                try {                    bw.close();                } catch (IOException e) {                    e.printStackTrace();                }            }        }    }}